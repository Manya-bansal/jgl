<!-- This file is the *AD* for a JGL experiment -->

<!-- This file should be stand-alone. All javascript, CSS, and html
should be contained within this single file. This helps ensure that 
the ad can be hosted on any HTTPS server, and still function correctly.
This is not a best practice, but fuck that shit. -->

<!-- This file relies on: mmturkey, which it uses to submit to mturk -->

<!doctype html>
<!-- 
	The ad.html has a very specific format.

	Really there are two "ads" contained within this file.

	The first ad displays to participants who are browsing
	the Amazon Mechanical Turk site but have not yet accepted
	your hit.  

	The second part of the ad display after the person selected
	"Accept HIT" on the Amazon website.  This will reload the
	ad and will display a button which, when clicked, will pop
	open a new browser window pointed at your local psiTurk
	server (assuming it is running and accessible to the Internet).

	See comments throughout for hints

-->
<html>
	<head>
		<title>Perception Experiment</title>
		<link rel=stylesheet href="https://dbirman.github.io/jgl/assets/css/bootstrap.min.css" type="text/css">
    <!-- JQUERY -->
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
		<script src="https://dbirman.github.io/jgl/assets/js/mmturkey.js"></script>
		<style>
			/* these tyles need to be defined locally */
			body {
			    padding:0px;
			    margin: 0px;
			    background-color: white;
			    color: black;
			    font-weight: 300; 
			    font-size: 13pt;
			}

			/* ad.html  - the ad that people view first */
			#adlogo {
			    float: right;
			    width: 140px;
			    padding: 2px;
			    border: 1px solid #ccc;
			}

			#container-ad {
			    position: absolute;
			    top: 0px; /* Header Height */
			    bottom: 0px; /* Footer Height */
			    left: 0px;
			    right: 0px;
			    padding: 100px;
			    padding-top: 5%;
			    border: 18px solid #f3f3f3;
			    background: white;
			}
		</style>
	</head>
	<body>
		<div id="container-ad">

			<div id="ad">
				<div class="row">
					<div class="col-xs-2">
						<!-- REPLACE THE LOGO HERE WITH YOUR  UNIVERSITY, LAB, or COMPANY -->
						<img id="adlogo" src="https://dbirman.github.io/jgl/assets/images/stanford.png" alt="Lab Logo" />
					</div>
					<div class="col-xs-10">

							<!-- 
								If assignmentid is "ASSIGNMENT_ID_NOT_AVAILABLE"
								it means the participant has NOT accepted your hit. 
								This should display the typical advertisement about
								your experiment: who can participate, what the
								payment is, the time, etc...

							-->
							<div id="preview">
							    <h1>Call for participants</h1>
							    <p>
									The Gardner Lab at Stanford University is looking for online participants for a brief psychology experiment. The only requirements are that you are at least 18 years old and are a fluent English 
									speaker. The task will take about 30 minutes and will pay $4 (approximately $8/hr).
							    </p>
							    <div class="alert alert-danger">
									<strong>This task can only be completed once.</strong> 
									If you have already completed this task before the system will not allow you to run again. If this looks familiar please return the HIT so someone else can participate.
							    </div>
							    <p>
								    Otherwise, please click the "Accept HIT" button on the Amazon site above to begin the task.
								</p>
							</div>

							<div id="active">
								<!-- 
									OTHERWISE
									If assignmentid is NOT "ASSIGNMENT_ID_NOT_AVAILABLE"
									it means the participant has accepted your hit. 
									You should thus show them instructions to begin the 
									experiment ... usually a button to launch a new browser
									window pointed at your server.

									It is important you do not change the code for the
									openwindow() function below if you want you experiment
									to work.
								-->
							    <h1>Thank you for accepting this HIT!</h1>
							    <p>
							    	By clicking the following URL link, you will be taken to the experiment, including complete instructions and an informed consent agreement.
							    </p>
							    <div class="alert alert-danger">
							    	<b>Warning</b>: Please keep this page open until the HIT completes.
							    </div>
							    <div class="alert alert-warning">
							    	<b>Warning</b>: Please disable pop-up blockers before continuing.
							    </div>
							    
						    	<button type="button" class="btn btn-primary btn-lg" onClick="openwindow();">Begin Experiment</button>
							</div>
							<!-- 
								endif
							-->
					</div>
			</div>
		</div>

		<script>// This is the ad logic. You shouldn't need to edit this unless you're running your server somewhere other than the gru.stanford.edu server (which you shouldn't do).

var debug;

function getExperiment() {
	debug = getQueryVariable('debug')=='true';
}

// $(document).ready(function() {launch();});

// function launch() {
// 	debug = getQueryVariable('debug')=='true';
// 	if (debug) {
// 		$("#preview").show();
// 		$("#active").show();
// 	} else if (turk.previewMode) {
// 		$("#preview").show();
// 		$("#active").hide();
// 	} else if (!turk.previewMode) {
// 		$("#preview").hide();
// 		$("#active").show();
// 	}
// };

var experimentWindow,path,expName;

function openwindow() {
	path = location.pathname;
	expName = path.substr(path.indexOf('ad-')+3,path.indexOf('.html')-(path.indexOf('ad-')+3));
	if (debug) {	
		experimentWindow = window.open('http://localhost:8080/exp.html?exp='+expName+'&debug=1','Popup','toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=no,width='+1024+',height='+768+'');
	} else {
		experimentWindow = window.open('http://localhost:8080/exp.html?exp='+expName,'Popup','toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=no,width='+1024+',height='+768+'');
	}
}

function submit() {
	var dataPackage = {
		turk:turk,
		path:path,
		expName:expName,
		success:true
	}
	experimentWindow.close();
	turk.submit(dataPackage);
}

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
}
</script>
	</body>
</html>
